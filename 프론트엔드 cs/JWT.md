# JWT (Json Web Token)

웹 토큰 기술 중 하나로, 사용자 인증 정보를 안전하게 전송하기 위해 만들어졌으며, 서버와 클라이언트 간에 정보를 안전하게 전달하기 위해 사용된다.

## 사용처

JWT는 JSON 포맷을 이용하여 사용자 정보를 저장하고 전달한다.
JWT는 서버에서 사용자를 인증하고 인가하는 데 사용되며, 클라이언트 측에서는 JWT를 저장하고 전송함으로써 사용자 인증 및 인가를 처리한다.
JWT는 사용자 정보를 암호화하여 전송하므로 정보가 `탈취`되는 것을 방지할 수 있다.

## 장점

JWT는 대부분의 웹 프레임워크에서 지원하고 있으며, 많은 회사에서 인증 기능 구현에 사용된다.
JWT는 암호화된 사용자 정보를 안전하게 전달할 수 있고, 서버에서 사용자 인증 정보를 저장할 필요가 없어서 서버 부담을 줄일 수 있다.

## 단점

JWT의 토큰 자체가 클라이언트에 저장되므로 탈취되면 보안이 약화된다.
해결법으로는 JWT를 저장할 때는 보안이 강화된 쿠키나 브라우저 스토리지 등을 사용한다.

JWT는 토큰 내에 모든 정보를 가지고 있기 때문에 토큰을 업데이트하거나 만료시간을 변경하려면 새로운 토큰을 발급받아야 한다.
ㄴ 토큰 관리가 복잡해질 수 있다.

JWT는 토큰의 사이즈가 커질 수 있다. 특히 토큰 내에 많은 정보를 담을 경우에는 서버에서 전송하는 응답의 크기가 증가할 수 있다.
해결법으로는 필요한 정보만을 담은 작은 토큰을 사용하는 방법도 있다.

JWT를 사용할 경우엔 서명키를 사용해야한다. 서명키가 유출되면 토큰이 위조될 수 있기 때문에 보안적인 취약점이 될 수 있다.
ㄴ 서명키를 안전하게 관리하자.

## JSON 형식 (Format)

- JSON(JavaScript Object Notation)은 데이터를 주고받기 위해 사용하는 경향의 데이터 형식(format)중 하나이다.
- JSON 형식에서는 키(key)와 값(value)의 쌍으로 이루어진 데이터 객체를 사용한다.

```js
{
    "id":"gildong",
    "password":"1234",
    "age":"25",
    "job":['programmer','student']
}
```

## 세션(Session) 개요

- 서버에서 가지고 있는 객체로, 특정 사용자의 로그인 정보를 유지하기 위해 사용할 수 있다.

## 세션(Session) 인증 방식 예시

1. 클라이언트가 서버에게 로그인 페이지 `요청`
2. 서버가 클라이언트에게 로그인 페이지 `응답`
3. 클라이언트가 서버에게 로그인 `요청`
4. 서버가 세션 생성 및 유지
5. 서버가 클라이언트에게 세션 ID 응답
6. 클라이언트가 브라우저에 세션 정보 저장
7. 클라이언트가 세션 ID와 함께 요청(글쓰기 등) 수행
8. 세션 ID를 통해 회원 ID 접근
9. 해당하는 회원에 대하여 서비스 수행

## 세션 방식의 특징

### 장점

- 클라이언트에게는 세션 ID를 제공하고, 회원에 대한 중요한 정보를 서버가 가지고 있다.
- 민감한 데이터를 클라이언트에게 직접적으로 보내지 않는다.
- 클라이언트 브라우저가 가지고 있는 세션 ID 자체에는 개인정보를 포함하고 있지 않다.

### 단점

- 악의적인 공격자가 세션 ID를 탈취하여 사용자인 척 위장할 수 있다.
- 세션 ID를 탈취당하는 경우, 사용자의 많은 권한 및 개인정보를 탈취당할 수 있다.
- 웹 서버에 세션 정보를 기록하고 있어야 하므로, 접속자가 많을 때 서버에 메모리 부하가 존재할 수 있다.

## Token 인증 방식

## JWT (JSON Web Token) 이란?

JWT는 인증에 필요한 정보를 암호화한 JSON 형식의 토큰입니다.
JWT 토큰을 HTTP 헤더에 실어 서버가 클라이언트를 식별할 수 있도록 합니다.

JWT는 세 가지 구성요소(Header, Payload, Signature)를 가집니다.
사용자가 인증을 수행하면, 서버는 다음의 정보를 가진 JWT 토큰을 발급합니다.
Header : 사용할 해시 알고리즘 등의 메타 정보를 포함.
Payload : 키(key)와 값(value) 형식으로 이루어진 정보(claim)의 구성.
→ 이 값을 전달합니다.
Signature : (헤더 + 페이로드 + (서버의 개인 키 정보)키(key)) 정보를 묶은 뒤에 해싱하여(겉으로 보기에 무작위의 값) Client에게 함께 전달합니다.

## JWT 예시

Header : {"alg" : "HS256", "typ" : "JWT"}
Payload : {"sub" : "user", "id" : "admin"}
Signature : 위 두 내용에 대하여 적절한 서버 키(key) 값을 더해 해싱한 값.

## JWT를 이용한 인증

나중에 사용자(client)는 자신이 받았던 JWT 토큰을 다시 서버에 전달합니다.
서버는 (헤더 + 페이로드 + 서버 내에 있는 키(Key))를 해싱한 값이 사용자로부터 전달받은 것과 일치하는지 체크합니다.
이 과정에서 서버가 가지고 있는 비밀키(secret key)를 사용합니다.

## JWT 인증 원리

사용자는 서버가 처음에 부여했던 권한만큼의 작업을 요청할 수 있습니다.
데이터를 변경하면 해시 값이 변경되므로, 악의적인 공격자가 Payload를 수정하는 것이 불가능합니다.
예를 들어 사용자의 등급이 1, 2, 3, 4, 5일 때 5등급의 사람이 1등급으로 Payload를 변경해 보냈다고 할 때, 이 경우, 서버의 키를 모르므로, 서명 값이 일치하지 않아 서버가 위조 여부를 알 수 있습니다.

## JWT 방식의 특징

### 장점

세션 기반 인증 방식에 비해 서버(Server)가 DB에 세션 정보를 가지고 있을 필요가 없습니다.
각 해시 값이 어떤 Header와 Payload를 가지는지 일일이 서버 DB에서 저장할 이유가 없습니다.
→ 서버에서 상태 정보를 저장하지 않아도 되므로, 무상태성(stateless)이 유지됩니다.
토큰 기반이므로, 서로 다른 웹 서버에 대해서도 동작할 수 있습니다. (웹 브라우저의 쿠키와 다른 점)

### 단점

세션에 비하여 토큰 자체의 데이터 길이가 길다.
페이로드(payload)는 암호화되지 않으므로, 중요한 정보를 담기 적절하지 않을 수 있습니다.
토큰을 탈취당하는 경우 보안상의 문제가 발생할 수 있습니다. (때문에 토큰에 사용 기한을 부여합니다.)

## JWT 토큰의 유의사항

Payload 자체는 중간자 공격에 의해 노출될 수 있으므로, 페이로드에는 가능한 민감 정보를 넣지 않습니다.
기본적으로 JWT의 목적은 정보 보호보다는 다음의 목적에 가깝습니다.

1. 위조 방지

2. 서버의 메모리 가용 이점(DB 조회 필요 없음)
